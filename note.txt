1. 大家好，我的答辩课题是IOS物联App相册动画优化<tap>
2. 今天我将从以下五个方面来对我的答辩项目进行讲解<tap>
3. 首先是我们的课题背景，我们为什么需要对App中的相册动画进行优化<tap>我们目前的TP-LINK物联App相册动画比较简单和系统相册的操作体验有比较大的差别，经过调研，App可以采用部分的系统相册的动画效果，从而提升用户在使用App相册时候的使用体验，右图为目前系统的相册App动画<tap>
4. 这个是我的优化总流程图，之后会对这个图进行拆分讲解<tap>
5. 接下来是我的主要工作<tap>
6. 根据我的优化总流程，主要工作从长按卡片动画设计，点击卡片动画设计，改变相册布局动画设计这三个方面展开。<tap>
7. 首先是长按卡片动画设计流程图中标红部分就是这一部分的主要设计，对于此处的大图卡片+功能键部分<tap>我封装了一个组件MenuView<tap>
8. 这个是MenuView的类图，在这里解释的是，MenuView依赖于一个结构体CardContent，CardContent是一个用来储存底下功能按键的结构体，他包含了每一个功能按键的标题，图片以及触发函数，MenuView对外提供三个接口，setupStructs, addStruct和addStructs三个接口，对于此优化项目中只用到了setupStructs的接口，当时和导师进行讨论时候，此模块不仅可以用到图片模块依旧可以用到消息等模块的长按触发的功能，所以考虑到此模块的复用性，<tap>我从系统提供的UIView控件得到启发设置addStruct和addStructs接口，防止一些情况下需要添加功能按键的问题<tap>
9. 我将以demo实现的形式去解释这个具体实现过程<tap>首先是这个相册页面<tap>我们长按这个cell<tap>这个时候就可以通过cell获取frame，生成一个一样大小的图层进行动画，<tap>后来我们再调用animate来更新frame，<tap>动画结束之后移除这个用来做动画的图层显示MenuView<tap>对于返回动画，核心的动画实现思路和长按时候是一致的，所以不过多赘述原理<tap>
10. 这个是放到项目里面的功能实现<tap>
11. 接下来是点击卡片动作的介绍<tap>
12. 标红的部分是这一部分要说明的内容，这一部分的动画和之前的长按动画在实现方法上，略有不同，这里是两个页面之间的跳转，需要用到了NavigationController去进行页面的入栈出栈，<tap>所以重构导航栏的动画需要用到UINavigationControllerDelegate<tap>
13. <tap>重构动画需要在这个navigationController的方法里面写，当返回值为nil时候就是采用的系统默认的返回动画，当返回值为UIViewControllerAnimatedTransitiong的时候返回的则是我们自定义的动画，在之后我们就把它叫做动画控制器<tap>
14. 这个是我在实现页面入栈和出栈时候的类图，入栈和出栈时候都需要实现上面这个协议，也就是前面所说的动画控制器<tap>
15. 现在我们来看动画控制器中必须要实现的两个方法，第一个是transitionDuration返回TimeInterval，设置动画时间用到，第二个是animateTransition，是实现具体动画的关键点首先，实现动画时候需要拿到上下文信息<tap>在这里我们可以通过transitionContext拿到上下文信息，然后就是设置具体动画，<tap>这里依旧以demo来展示，在图中我们点击cell获取frame基于此frame去生成一个做动画的imageView，然后调用animate修改imageView的frame，<tap>最后在动画结束时候移除动画图层，展示详情页面，pop动画原理和push一样<tap>
16. 这个是push和pop的具体实现流程，在pop中由于要找到图片回去的位置，所以需要对上一页信息进行判断<tap>
17. 这个是点击卡片的动画，由于设备原因，视频没办法很好的播放，动图是10帧的，所以看起来有点不流畅<tap>
18. 接下来是改变相册布局动画的设计
19. 在总流程中就是最大的这条线<tap>
20. 这是缩放动画的实现策略，判断是否是最大最小，最大则不能继续放大，最小则不能继续缩小<tap>基于此流程结合项目，一共设计了三种布局<tap>
21. 这是三种布局的设计，三种布局根据与原始布局宽高比一致进行设计，这个是三种布局的截图<tap><tap><tap><tap>
22. 想要实现该效果比较复杂，所以在这里，我采用想到一种方案去做一种方案的形式，这个是已实现的方案思路：方案一就是通过设置显示图层和操作图层的方式去实现动画效果，右图为效果；方案二是通过相册交互式重组的方案进行缩放，手指停下来时候整个相册布局也会停下来，虽然有交互，但是在交互过程中视觉体验不是很好；方案三是直接根据手势结束之后的状态来改变布局，这个动画效果和方案二是一样的，但是不会在手指停下来时候布局也对应停下来，视觉体验相较于方案二比较好，所以最终和导师商讨之后选择方案三<tap>
23. 这个是最终所有功能和起来的结果图<tap>
24. 后来是我在本课题中遇到的难处理问题以及解决方案<tap>
25. <tap>问题一的现象为：进入详情页面有时候返回时候是默认动画<tap>，首先是我的复现思路：根据以下三点去复现，最终发现问题<tap>出现在第三点，<tap>因为有时候返回是正常的，所以进行断点调试，发现是通过indexPath找不到cell，查找资料发现，cell没有进入到页面时候是没有自己的frame之类的信息的，所以<tap>只需要在跳转之前对indexPath进行是否在当前页面进行判断，修改collectionView的偏移量即可解决问题<tap>
26. <tap>第二个问题是退出相册页面了，然后进入其他页面，理论上应该都是默认的转场动画了，但是又出现了像相册页面一样的转场动画。这个问题的解决思路就很明显了，既然出现了动画那么在delegate中打断点进行调试，最终发现问题是navigationController控制页面的问题，所以只需要在进入到delegate中，给delegate置为nill即可解决问题<tap>那么为什么只出现在push中而不出现在pop中呢？根据之前的流程图中，由于我们需要判断是否回到了相册主页面等等的操作，所以只要不是详情页到主页面就一定会在其中一个判断时候返回nil<tap>
27. <tap>长按卡片之后有时页面会出现页面整体上移的现象，首先，我先复现问题<tap><tap>按照这三点去复现问题，最后发现是最后一点<tap>时候出现了问题，<tap>根据此猜想分析问题<tap>在目前的代码实现中只有让导航栏消失和出现时候会出现问题，所以，提出猜想，导航栏消失页面会整体上移，出现时候页面会整体下移，右边为demo验证，其实这个问题再分析一层就会发现核心点事collectionView的contentOffset不一致的问题，所以最终的解决方案最简单的就是记录contentOffset返回时候重置
28. 接下来是自测结果
29. 自测的列表，是我分析了所有可能存在的手势冲突进行设计自测的
30. 最后是我的总结与反思
31. 
32. 感谢各位评委老师的聆听，请各位评委老师指正